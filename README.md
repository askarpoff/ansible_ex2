## 08-ansible-02-playbook (UPD)

## Описание

Playbook устанавливает на 2 машины (ОС из семейства RedHat, CentOS, Fedora, Oracle Linux) с доступом по ssh  - пакеты ПО Clickhouse и Vector

## Параметры

В group_vars/clickhouse/vars.yml и group_vars/vector/vars.yml  задаются соответственно версии Clickhouse и Vector.

group_vars/clickhouse/vars.yml

| Имя           | Значение по умолчанию | Описание                        |
| -------------- | ------------- | -----------------------------------|
| `clickhouse_version` |  "22.3.3.44" | Версия Clickhouse |
| `clickhouse_packages` | clickhouse-client, clickhouse-server, clickhouse-common-static | Пакеты Clickhouse для установки |

group_vars/vector/vars.yml

| Имя           | Значение по умолчанию | Описание                        |
| -------------- | ------------- | -----------------------------------|
| `vector_version` | "0.27.0" | Версия Vector |

В inventory/prod.yml задаются хосты для установки и доступы к ним


## Теги

Тегирование --tags clickhouse или --tags vector позволяет выполнить задачи по установке по-отдельности

## Результат работы плейбука
```bash
ansible-playbook site.yml -i inventory/prod.yml

PLAY [Install Clickhouse] *******************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************************
The authenticity of host '10.1.1.17 (10.1.1.17)' can't be established.
ECDSA key fingerprint is SHA256:zkTxKMnvKKcsal4anEFa9pziAlR+wM7mvRKORCyCwCw.
Are you sure you want to continue connecting (yes/no)? yes
ok: [clickhouse-01]

TASK [Get clickhouse distrib] ***************************************************************************************************************************************************************************************************************
changed: [clickhouse-01] => (item=clickhouse-client)
changed: [clickhouse-01] => (item=clickhouse-server)
failed: [clickhouse-01] (item=clickhouse-common-static) => {"ansible_loop_var": "item", "changed": false, "dest": "./clickhouse-common-static-22.3.3.44.rpm", "elapsed": 0, "item": "clickhouse-common-static", "msg": "Request failed", "response": "HTTP Error 404: Not Found", "status_code": 404, "url": "https://packages.clickhouse.com/rpm/stable/clickhouse-common-static-22.3.3.44.noarch.rpm"}

TASK [Get clickhouse distrib] ***************************************************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Install clickhouse packages] **********************************************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Flush_handlers] ***********************************************************************************************************************************************************************************************************************

RUNNING HANDLER [Start clickhouse service] **************************************************************************************************************************************************************************************************
changed: [clickhouse-01]

TASK [Create database] **********************************************************************************************************************************************************************************************************************
changed: [clickhouse-01]

PLAY [Install Vector] ***********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************************
The authenticity of host '10.1.1.6 (10.1.1.6)' can't be established.
ECDSA key fingerprint is SHA256:JiGfEfsE160hb2ZWAz2cuSkH2GFikFzbZzSR5Dwzn+Q.
Are you sure you want to continue connecting (yes/no)? yes
ok: [vector-01]

TASK [Get vector distrib] *******************************************************************************************************************************************************************************************************************
changed: [vector-01]

TASK [Install vector packages] **************************************************************************************************************************************************************************************************************
changed: [vector-01]

RUNNING HANDLER [Start vector service] ******************************************************************************************************************************************************************************************************
changed: [vector-01]

PLAY RECAP **********************************************************************************************************************************************************************************************************************************
clickhouse-01              : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=1    ignored=0
vector-01                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
